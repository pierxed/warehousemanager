<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gestionale Magazzino</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <div class="app">

    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="brand">
        <div class="brand-title">Gestionale</div>
        <div class="brand-sub">Warehouse Manager</div>
      </div>
      <button class="menu-toggle" id="menu_toggle" type="button" aria-expanded="false">
        ☰ Menu
      </button> 

      <!-- Tabs: stessi bottoni e data-target -->
      <nav class="tabs sidebar-nav">
        <button class="tab-btn active" data-target="tab_home" type="button">Home</button>
        <button class="tab-btn" data-target="tab_products" type="button">Prodotti</button>
        <button class="tab-btn" data-target="tab_production" type="button">Produzione</button>
        <button class="tab-btn" data-target="tab_sale" type="button">Vendita</button>
        <button class="tab-btn" data-target="tab_stock" type="button">Stock</button>
        <button class="tab-btn" data-target="tab_lots" type="button">Lotti</button>
      </nav>

      <div class="sidebar-footer">
        <div class="pill">v0.1</div>
        <div class="muted">Locale (MAMP)</div>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="main">
      <!-- TOPBAR -->
      <header class="topbar">
        <div>
          <h1 class="page-title">Gestionale Magazzino</h1>
          <p class="page-subtitle">Produzione, stock e lotti — tutto in un posto</p>
        </div>

        <div class="topbar-actions">
          <!-- opzionale: puoi usarla più avanti per filtrare tabelle -->
          <input class="input" id="global_search" placeholder="Cerca (EAN, lotto, prodotto)..." />
        </div>
      </header>

      <!-- Toasts: non tocchiamo ID -->
      <div id="expiry_toasts"></div>

      <div class="container">

        <!-- HOME -->
       <section id="tab_home" class="tab active">

  <div class="section-head">
    <h2 class="h2">Home</h2>
    <div class="muted">Riepilogo rapido</div>
  </div>

  <!-- KPI -->
  <div class="dashboard-cards">
    <div class="card kpi">
      <h3>Stock totale (barattoli)</h3>
      <p id="card_total_stock">0</p>
    </div>

    <div class="card kpi">
      <h3>Lotti in scadenza &lt; 30gg</h3>
      <p id="card_expiring">0</p>
    </div>

    <div class="card kpi">
      <h3>Barattoli prodotti oggi</h3>
      <p id="card_today_production">0</p>
    </div>
  </div>

  <!-- CONTENUTI HOME -->
  <div class="home-grid">

    <!-- SCADENZE -->
    <div class="card">
      <div class="card-head">
        <h3>Scadenze</h3>
        <div class="muted">Solo stock &gt; 0</div>
      </div>

      <div class="home-split">
        <div class="mini-block">
          <div class="mini-title">
            <span class="badge danger">0–7 giorni</span>
          </div>

          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Prodotto</th>
                  <th>Lotto</th>
                  <th>Stock</th>
                  <th>Scad.</th>
                </tr>
              </thead>
              <tbody id="expiry_7_table"></tbody>
            </table>
          </div>
        </div>

        <div class="mini-block">
          <div class="mini-title">
            <span class="badge warn">8–30 giorni</span>
          </div>

          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Prodotto</th>
                  <th>Lotto</th>
                  <th>Stock</th>
                  <th>Scad.</th>
                </tr>
              </thead>
              <tbody id="expiry_30_table"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- ULTIMI MOVIMENTI -->
    <div class="card">
      <div class="card-head">
        <h3>Ultimi movimenti</h3>
        <div class="muted">Ultimi 10</div>
      </div>

      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Data</th>
              <th>Tipo</th>
              <th>Prodotto</th>
              <th>Lotto</th>
              <th>Scad.</th>
              <th>Q.tà</th>
            </tr>
          </thead>
          <tbody id="last_moves_table"></tbody>
        </table>
      </div>
    </div>

    <!-- GRAFICO VENDITE TOP -->
    <div class="card">
      <div class="card-head">
        <h3>Top vendite per prodotto</h3>
        <div class="muted">Ultimi 30 giorni</div>
      </div>

      <div class="chart-wrap">
        <canvas id="salesChart"></canvas>
      </div>
    </div>

  </div>
</section>

        <!-- PRODOTTI -->
        <section id="tab_products" class="tab">

          <div class="section-head">
            <h2 class="h2">Prodotti</h2>
            <div class="muted">Crea e gestisci catalogo</div>
          </div>

          <div class="card product-create-card">
            <div class="card-head">
              <h3>➕ Nuovo Prodotto</h3>
              <div class="muted">Compila e salva</div>
            </div>

            <div class="create-grid">
              <input type="text" id="new_product_name" placeholder="Nome prodotto">
              <input type="text" id="new_product_format" placeholder="Formato (es: 200g)">
              <input type="text" id="new_product_fish" placeholder="Es: TONNO, SGOMBRO...">
              <input type="text" id="new_product_ean" placeholder="EAN">
              <input type="number" id="new_product_units" placeholder="Unità per vassoio" min="1">
              <input type="file" id="new_product_image" accept="image/*">
            </div>

            <div class="row">
              <button id="btn_add_product" class="btn-create" type="button">Crea Prodotto</button>
              <div id="product_message" class="message"></div>
            </div>
          </div>

          <div class="card">
            <div class="card-head">
              <h3>Prodotti esistenti</h3>
              <div class="muted">Lista</div>
            </div>
            <div id="products_container" class="products-grid"></div>
          </div>
        </section>

        <!-- PRODUZIONE -->
        <section id="tab_production" class="tab">
          <div class="section-head">
            <h2 class="h2">Produzione</h2>
            <div class="muted">Registra produzione e lotti</div>
          </div>

          <div class="split">
            <div class="card">
              <div class="card-head">
                <h3>Nuova registrazione</h3>
                <div class="muted">Scan → quantità → lotto → scadenza</div>
              </div>

            <div class="production-layout">

  <!-- SCAN CENTRALE -->
  <div class="scan-row">
    <label>Scansiona prodotto</label>
    <input type="text" id="prod_ean" placeholder="Scansiona EAN prodotto..." autofocus>
  </div>

  <!-- riga 1 -->
  <div class="form-grid">
    <div class="form-group">
      <label>Prodotto:</label>
      <select id="product_name_select"></select>
    </div>

    <div class="form-group">
      <label>Formato:</label>
      <select id="prod_select"></select>
      <small id="prod_info" class="help"></small>
    </div>
  </div>

  <!-- riga 2 -->
  <div class="form-grid">
    <div class="form-group">
      <label>Tipo quantità:</label>
      <select id="quantity_type">
        <option value="trays">Vassoi</option>
        <option value="units">Barattoli</option>
      </select>
    </div>

    <div class="form-group">
      <label>Quantità:</label>
      <input type="number" id="quantity_input" min="1">
    </div>
  </div>

  <!-- riga 3 -->
  <div class="form-grid">
    <div class="form-group">
      <label>Lotto:</label>
      <input type="text" id="lot_number" list="lot_suggestions">
      <div id="lot_warning"></div>
      <datalist id="lot_suggestions"></datalist>
      <div id="lot_quick" class="lot-quick"></div>
    </div>

    <div class="form-group">
      <label>Scadenza:</label>
      <input type="date" id="expiration_date">
    </div>
  </div>

</div>

              <div class="row">
                <button id="btn_production" type="button" class="btn-primary">Registra Produzione</button>
                <div id="prod_message" class="message"></div>
              </div>
            </div>

            <div class="card">
              <div class="card-head">
                <h3>Note rapide</h3>
                <div class="muted">Pannello info</div>
              </div>
              <ul class="list">
                <li>Scansiona EAN e controlla il formato.</li>
                <li>Usa i suggerimenti lotto per velocizzare.</li>
                <li>Se qualcosa non torna, annulla e rifai (meglio pulito).</li>
              </ul>
            </div>
          </div>
        </section>

        <!-- VENDITA -->
<section id="tab_sale" class="tab">
  <div class="section-head">
    <h2 class="h2">Vendita</h2>
    <div class="muted">Scarico rapido stock</div>
  </div>

  <div class="card">
    <div class="form-grid">
  <div class="form-group">
    <label>Prodotto (nome):</label>
    <select id="sale_product_name_select">
      <option value="">-- Seleziona prodotto --</option>
    </select>
  </div>

  <div class="form-group">
    <label>Formato:</label>
    <select id="sale_prod_select">
      <option value="">-- Seleziona formato --</option>
    </select>
  </div>
</div>

<div class="form-grid" style="margin-top:10px;">
  <div class="form-group">
    <label>EAN Prodotto (opzionale):</label>
    <input type="text" id="barcode" placeholder="Scansiona o inserisci EAN">
    <div class="muted">Se inserisci EAN, selezione prodotto/formato si aggiorna.</div>
  </div>

  <div class="form-group">
    <label>Quantità (barattoli):</label>
    <input type="number" id="sale_qty" value="1" min="1">
  </div>
</div>

<div class="row" style="gap:12px; align-items:center; margin-top:10px;">
  <label style="display:flex; gap:8px; align-items:center; cursor:pointer;">
    <input type="checkbox" id="sale_manual_toggle">
    <span>Selezione lotto manuale</span>
  </label>
  <span class="muted" id="sale_plan_hint"></span>
</div>

<!-- MANUALE -->
<div id="sale_manual_box" style="display:none; margin-top:10px;">
  <div class="muted" style="margin-bottom:6px;">
    Seleziona uno o più lotti. Completa la quantità richiesta.
  </div>

  <div class="row" style="gap:8px; flex-wrap:wrap; margin-bottom:10px;">
    <div class="muted">Lotti disponibili:</div>
    <div id="sale_lot_chips" class="row" style="gap:8px; flex-wrap:wrap;"></div>
  </div>

  <div class="row" style="gap:8px; flex-wrap:wrap; margin-bottom:10px;">
    <div class="muted">Selezionati:</div>
    <div id="sale_selected_chips" class="row" style="gap:8px; flex-wrap:wrap;"></div>
  </div>

  <div id="sale_manual_status" class="muted"></div>
</div>


    <div class="row" style="margin-top:10px;">
      <button id="btn_sale" type="button" class="btn-primary">Registra Vendita</button>


      <div id="sale_message" class="message"></div>
    </div>
      <!-- BOX conferma 2-step -->
<div id="sale_confirm_box" style="margin-top:12px;"></div>

<!-- BOX manuale (se già lo usi) -->
<div id="sale_manual_box" style="display:none; margin-top:12px;">
  <div id="sale_manual_status" class="muted"></div>

  <div style="margin-top:10px;">
    <div class="muted" style="margin-bottom:6px;">Lotti selezionati</div>
    <div id="sale_selected_chips"></div>
  </div>

  <div style="margin-top:12px;">
    <div class="muted" style="margin-bottom:6px;">Suggerimenti lotti</div>
    <div id="sale_lot_chips"></div>
  </div>
</div>
    
  </div>
</section>

        <!-- STOCK -->
        <section id="tab_stock" class="tab">
          <div class="section-head">
            <h2 class="h2">Stock Totale</h2>
            <div class="muted">Vista per prodotto</div>
          </div>

          <div class="card">
            <div class="table-wrap">
              <table id="stock_table">
                <thead>
                  <tr>
                    <th>Tipo Pesce</th>
                    <th>Prodotto</th>
                    <th>Formato</th>
                    <th>EAN</th>
                    <th>Stock (barattoli)</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- LOTTI -->
        <section id="tab_lots" class="tab">
          <div class="section-head">
            <h2 class="h2">Lotti Dettagliati</h2>
            <div class="muted">Vista completa</div>
          </div>

          <div class="card">
            <div class="table-wrap">
              <table id="lots_table">
                <thead>
                  <tr>
                    <th>Pesce</th>
                    <th>Prodotto</th>
                    <th>Formato</th>
                    <th>EAN</th>
                    <th>Lotto</th>
                    <th>Stock</th>
                    <th>Produzione</th>
                    <th>Scadenza</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </section>

      </div>
    </main>
  </div>

  <script src="dashboard.js"></script>
  <script>
  window.addEventListener("DOMContentLoaded", () => {
    const sidebar = document.querySelector(".sidebar");
    const btn = document.getElementById("menu_toggle");
    if(!sidebar || !btn) return;

    const setIcon = () => {
      const open = sidebar.classList.contains("menu-open");
      btn.textContent = open ? "✕ Chiudi" : "☰ Menu";
      btn.setAttribute("aria-expanded", open ? "true" : "false");
    };

    btn.addEventListener("click", () => {
      sidebar.classList.toggle("menu-open");
      setIcon();
    });

    // chiudi menu quando clicchi una tab (solo mobile)
    document.querySelectorAll(".tab-btn").forEach(b => {
      b.addEventListener("click", () => {
        if (window.matchMedia("(max-width: 680px)").matches) {
          sidebar.classList.remove("menu-open");
          setIcon();
        }
      });
    });

    // set iniziale
    setIcon();
  });
</script>
</body>
</html>